<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <record id="view_purchase_order_form_sec" model="ir.ui.view">
    <field name="name">purchase.order.form.sec</field>
    <field name="model">purchase.order</field>
    <field name="inherit_id" ref="purchase.purchase_order_form"/>
    <field name="arch" type="xml">

      <!-- 1) (Opcional) Botones de estado de adjuntos dentro del button_box.
           Usamos un selector más robusto y NO afecta la instalación si el div existe. -->
      
      <!--xpath expr="//sheet/*[1]" position="before">
        <div class="oe_button_box" name="sec_button_box">
        <button type="object" name="action_view_attached_docs"
                class="oe_stat_button o_button_danger"
                attrs="{'invisible': [('sec_attachment_state', '!=', 'red')]}">
            <field name="message_attachment_count" string="Adjuntos" widget="statinfo"/>
        </button>
        <button type="object" name="action_view_attached_docs"
                class="oe_stat_button o_button_warning"
                attrs="{'invisible': [('sec_attachment_state', '!=', 'orange')]}">
            <field name="message_attachment_count" string="Adjuntos" widget="statinfo"/>
        </button>
        <button type="object" name="action_view_attached_docs"
                class="oe_stat_button o_button_success"
                attrs="{'invisible': [('sec_attachment_state', '!=', 'green')]}">
            <field name="message_attachment_count" string="Adjuntos" widget="statinfo"/>
        </button>
        </div>
    </xpath-->

      <!--2) Alerta de MXN pendiente: insértala DESPUÉS del primer group
             (o bien antes del notebook) para evitar selector ambiguo. -->
      <!--xpath expr="//sheet//group[1]" position="after">
        <div class="alert alert-danger" role="alert"
             attrs="{'invisible': [('sec_mxn_pending', '=', False)]}">
          <span>MXN pendiente de captura para control presupuestal.</span>
        </div>
      </xpath-->

      <!-- 3) Bloque SECIHTI: antes del notebook para que quede al final de la primera sección
             y a lo ancho. Usa col=4 para ganar espacio horizontal. -->
      <xpath expr="//sheet/notebook" position="before">
        <group string="SECIHTI" col="4">
          <field name="sec_project_id" options="{'no_open': False}"
                 context="{'default_company_id': company_id}"/>
          <field name="sec_stage_id" domain="[('project_id', '=', sec_project_id)]"/>
          <field name="sec_activity_id" domain="[('stage_id', '=', sec_stage_id)]"/>
          <field name="sec_rubro_id"/>
          <field name="sec_total_mxn_manual"
                 attrs="{'readonly': [('currency_id', '=', company_currency_id)]}"/>
          <field name="sec_mxn_pending" readonly="1"/>
        </group>
      </xpath>

    </field>
  </record>

  <!--record id="view_purchase_order_tree_sec_total_mxn" model="ir.ui.view">
    <field name="name">purchase.order.tree.sec.total.mxn</field>
    <field name="model">purchase.order</field>
    <field name="inherit_id" ref="purchase.purchase_order_tree"/>
    <field name="arch" type="xml">
        <!-- Insertar después del total -->
        <xpath expr="//tree//field[@name='amount_total']" position="after">
        <field name="sec_total_mxn_manual"/>
        </xpath>
    </field>
    </record-->
</odoo>
